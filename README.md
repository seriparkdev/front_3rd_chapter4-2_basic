# 바닐라 JS 프로젝트 성능 개선
- url: https://dxlinx0dzob0o.cloudfront.net

## 성능 개선 보고서
### 1. 개선 이유

<br/>

<img width="945" alt="스크린샷 2024-11-29 오전 9 55 50" src="https://github.com/user-attachments/assets/e1a660e3-5a5a-44c3-9b7b-5520fc610c45">
<img width="949" alt="스크린샷 2024-11-29 오전 9 56 28" src="https://github.com/user-attachments/assets/bc0d254b-f384-4a83-b29b-aea299a3b56e">

<br/>
<br/>

전체적으로 성능 문제가 있어 개선이 필요합니다. **TBT(Total Blocking Time)** 은 710ms로 Google에서 권장하는 200ms를 크게 초과하는 수치로, 사용자들이 웹페이지와 상호작용할 때 답답함을 느낄 수 있습니다. 또한 **LCP{Largest Contentful Paint)** 가 18.6초로 매우 느린데, 이는 권장 기준인 2.5초의 7배가 넘는 시간으로 사용자들이 주요 콘텐츠를 보기까지 오래 기다려야 하기 때문에 개선이 필요합니다. **FCP(First Contentful Paint)** 는 2.4초로 권장 기준인 1.8초보다 느립니다.

<br/>
<br/>

| 측정 항목 | 현재 수치 | 권장 수치 | 상태 |
|----------|-----------|-----------|----|
| Total Blocking Time (TBT) | 710ms | 200ms 이하 | 🔴 |
| Largest Contentful Paint (LCP) | 18.6초 | 2.5초 이하 | 🔴 |
| First Contentful Paint (FCP) | 2.4초 | 1.8초 이하 | 🟠 |
| 전체 성능 점수 | 54점 | 90점 이상 | 🟠 |

<br/>

### 2. 개선 방법
**💡 이미지에 사이즈를 지정하여 layout shift 개선**

이미지에 명시적인 width와 height를 지정하지 않은 경우에는 브라우저가 HTML을 파싱하다가 이미지 태그를 만나도 얼마만큼의 공간을 할당해야 할지 알 수 없기 때문에, __이미지 로드가 완료된 후에야 공간을 확보__ 하게 됩니다. 이 과정에서 갑자기 공간이 생기면서 다른 요소들이 밀리게 되어 Layout Shift가 발생하게 됩니다.

반면 사이즈를 명시적으로 지정하면 브라우저가 렌더링 과정에서 __이미지가 실제로 로드되기 전에 미리 공간을 확보__ 해둘 수 있기 때문에 이미지가 로드되어도 다른 요소들이 밀리지 않고 확보된 공간에 이미지가 들어가서 방식으로 레이아웃 시프트를 방지할 수 있습니다.

<br/>

**💡 폰트를 외부 서버에서 호스팅하는 방식에서 셀프 호스팅으로 변경**

<img width="945" alt="스크린샷 2024-11-29 오전 10 16 52" src="https://github.com/user-attachments/assets/71187e39-230b-4df2-8365-65744c603dd3">

<br/>
<br/>

외부 폰트 서비스를 사용할 때는 추가적인 네트워크 요청이 발생하기 때문에 브라우저가 외부 폰트를 다운로드 받고 처리하는 동안 텍스트 렌더링을 지연시키거나 보이지 않게 처리하여 렌더링이 차단될 수 있습니다. 반면 셀프 호스팅을 하면 폰트 파일이 서버에 있어 추가적인 외부 연결 없이 바로 로드할 수 있어 렌더링 차단 시간을 줄일 수 있습니다.

<br/>

**💡 쿠키 사용 동의 관련 스크립트 defer 방식으로 가져오기**

script 태그에 defer 속성을 부여하는 것은 HTML 파싱을 차단하지 않고 병렬로 스크립트를 다운로드하게 해주기 때문에 DOM 구축 중에 방해받지 않아 페이지 로딩 속도가 개선됩니다.

<br/>

**💡 이미지 webp 파일 형식 사용 및 압축 작업**

WebP는 JPEG이나 PNG와 비교했을 때 동일한 화질에서 20-30% 더 작은 파일 크기를 제공합니다. 파일 크기가 작아지면 네트워크 대역폭 사용량이 줄어들어 페이지 로딩 속도가 빨라집니다.

<br/>

**💡 Intersection Observer를 통해 product list 지연 로딩**

초기 페이지 로드 시에는 product list가 viewport에 들어오지 않기 때문에 초기에 렌더링 하지 않아도 되는 요소입니다. 따라서 사용자가 스크롤하여 해당 영역에 접근했을 때 Intersection Observer로 감지하여 관련 스크립트를 로드하면, 초기 페이지 로드 시의 자원 사용을 줄이고 로딩 성능을 개선할 수 있습니다.

<br/>

**💡 국가별 할인율을 표시해주는 안내바에 의한 layout shift 개선**

국가별 할인율을 표시해주는 안내바는 페이지 렌더링 후 1초 뒤 hidden 처리되어 layout shift를 일으킵니다. 따라서 `opacity: 0` 속성을 지정하여 시각적으로 눈에서 안내바가 사라져도 공간을 차지 할 수 있게 변경하여 다른 콘텐츠들의 위치 이동이 발생하지 않도록 했습니다.

<br/>

**💡 디바이스 크기에 맞는 이미지만 가져오도록 수정**

srcset을 사용하면 디바이스의 크기와 해상도에 맞는 최적화된 이미지를 제공할 수 있습니다. 이를 통해 불필요한 데이터 전송을 줄이고 로딩 시간을 단축할 수 있도록 했습니다.

<br/>

### 3. 개선 후 향상된 지표

<br/>

<img width="946" alt="스크린샷 2024-11-29 오전 10 43 51" src="https://github.com/user-attachments/assets/efb9f24d-0c85-4109-8922-eea21608822e">

<img width="949" alt="스크린샷 2024-11-29 오전 10 44 44" src="https://github.com/user-attachments/assets/d1a50d7b-6ae8-4b3c-8e2c-8d51f883ba9e">

<br/>
<br/>

| 측정 항목 | 이전 수치 | 현재 수치 | 차이 | 상태 |
|-----------|-----------|-------|------|------|
| Total Blocking Time (TBT) | 710ms | 0ms   | ⬇️ -710ms | 🟢  |
| Largest Contentful Paint (LCP) | 18.6초 | 0.5초  | ⬇️ -18.1초 | 🟢  |
| First Contentful Paint (FCP) | 2.4초 | 0.2초  | ⬇️ -2.2초 | 🟢  |
| 전체 성능 점수 | 54점 | 100점  | ⬆️ +46점 | 🟢  |  |

